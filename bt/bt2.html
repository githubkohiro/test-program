<html>
<head>
	<title>demo HTML5 Bluetooth demo</title>
	<meta content="text/html; charset=utf-8" http-equiv="Content-type">
	<meta name="viewport" content="width=device-width" />
</head>
<body>
	<button id="bt" onclick="bts3()" style="font-size:150%">BT search3</button>
	

	<!-- 画面上に書く場所指定。ここへの記載はbodyなのでもちろんhtml -->
	<div id="output"></div>

	<script type="text/javascript">
		var x=document.getElementById("output");
		
		function bts3() {
		navigator.bluetooth.requestDevice({
//			filters: [{
//				services: ['heart_rate'],
//			}]})
			filters: anyDevice()})
			//1個でもみつけて選択してもらえば下に進む。それ以外をNGとする。
			.then( a("!!bts2.finding devices") )
			.then( console.log("!!bts2.finding devices") )
// 			.then(device => device.gatt.connect())
//			.then(server => server.getPrimaryService('heart_rate'))
//			.then(service => {
//				chosenHeartRateService = service;
//				return Promise.all([
//					service.getCharacteristic('body_sensor_location')
//					.then( /* do some processing */),
//					service.getCharacteristic('heart_rate_measurement')
//					.then( /* do some processing */),
//				]);
//			})
			.catch(error => console.log(error));
		}
		
		function anyDevice() {
  				return Array.from('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ')
      			.map(c => ({namePrefix: c}))
      			.concat({name: ''});
      	}
      	
      	function a(hoge) {
          x.innerHTML=hoge;
        }
</script>
</body>
</html>
